## NOI2016 循环之美

### statement

给定$n,m,k\quad (n,m\leq 10^9,2\leq k\leq 2e3)$
求$\sum_{x=1}^n\sum_{y=1}^mf(x,y,k)$
其中$f(x,y,k)$为$1$当且仅当$\gcd(x,y)=1$且$\frac{x}{y}$是$k$进制下的纯循环小数可以表示为$a.\dot{c_1} c_2 c_3 \ldots c_{p - 1} \dot{c_p}$的形式.
比如$13.0,\ 0.\dot{4}\dot{5}$是$0.1\dot{6}$不是.

### solution

#### part1

考虑$f(x,y,k)=1$的等价条件,仅考虑小数部分$\{x\}=x-[x]$
$$
\{\frac{x}{y}\}=\{a.\dot{c_1} c_2 c_3 \ldots c_{p - 1} \dot{c_p}\}=0.\dot{c_1} c_2 c_3 \ldots c_{p - 1} \dot{c_p}\\
\{k^p\frac{x}{y}\}=0.\dot{c_1} c_2 c_3 \ldots c_{p - 1} \dot{c_p}=\{\frac{x}{y}\}\\

\implies \{(k^p-1)\frac{x}{y}\}=0
$$

这说明$(k^p-1)\frac{x}{y}$是一个整数(是不是整数和进制没关系),即$y\mid (k^p-1)x\implies (k^p-1)x\equiv 0\pmod y$
而$(x,y)=1$故$x^{-1}\bmod y$存在,两边乘上,有$k^p-1\equiv 0\pmod y$即$k^p\equiv 1\pmod y$

我们发现$f(x,y,k)=1\Leftrightarrow [(x,y)=1\and(\exists p\gt 0,k^p\equiv 1\pmod y)]$
遇到这种式子肯定要用上欧拉定理$(a,m)=1\implies a^{\varphi(m)}\equiv 1\pmod m$

当$(k,y)=1$时显然$p$存在,当$(k,y)\neq 1$时$(k^{p-1})k\equiv 1\pmod y$有$k^{-1}\equiv k^{p-1}\pmod y$这与$(k,y)\neq 1$矛盾.
综上所述$f(x,y,k)=[(x,y)=1\and (k,y)=1]=[x\perp y][k\perp y]$

### code





==to be continued==